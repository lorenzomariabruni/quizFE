<div class="container">
  <div class="card" style="margin-top: 50px; max-width: 900px; margin-left: auto; margin-right: auto;">
    <h1 style="text-align: center; color: #667eea; margin-bottom: 30px;">
      â• Crea Nuovo Quiz
    </h1>

    <!-- Error/Success messages -->
    <div *ngIf="error" style="background: #fed7d7; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
      <p style="color: #c53030; margin: 0;">âŒ {{ error }}</p>
    </div>

    <div *ngIf="success" style="background: #c6f6d5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
      <p style="color: #22543d; margin: 0;">âœ… {{ success }}</p>
    </div>

    <!-- Step 1: Create Quiz -->
    <div *ngIf="!quizCreated">
      <h2 style="color: #667eea; margin-bottom: 20px;">1. Informazioni Quiz</h2>
      
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Nome Quiz (ID):</label>
        <input 
          type="text" 
          [(ngModel)]="quizName" 
          placeholder="es: quiz-storia-2024"
          style="width: 100%;"
        />
        <small style="color: #666;">Usato come identificatore (solo lettere, numeri, - e _)</small>
      </div>

      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Titolo:</label>
        <input 
          type="text" 
          [(ngModel)]="quizTitle" 
          placeholder="es: Quiz di Storia - Seconda Guerra Mondiale"
          style="width: 100%;"
        />
      </div>

      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Descrizione (opzionale):</label>
        <textarea 
          [(ngModel)]="quizDescription" 
          placeholder="Breve descrizione del quiz..."
          rows="3"
          style="width: 100%; resize: vertical;"
        ></textarea>
      </div>

      <div style="display: flex; gap: 10px;">
        <button class="btn btn-secondary" (click)="goBack()" style="flex: 1;">
          â† Annulla
        </button>
        <button 
          class="btn btn-primary" 
          (click)="createQuiz()" 
          [disabled]="loading || !quizName.trim() || !quizTitle.trim()"
          style="flex: 2;">
          {{ loading ? 'â³ Creazione...' : 'â†’ Continua' }}
        </button>
      </div>
    </div>

    <!-- Step 2: Add Questions -->
    <div *ngIf="quizCreated">
      <div style="background: #f7faff; padding: 20px; border-radius: 12px; margin-bottom: 30px; border-left: 4px solid #667eea;">
        <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 20px;">
          <div style="flex: 1; min-width: 200px;">
            <p style="margin: 0; font-weight: 600; font-size: 18px; color: #667eea;">ğŸ® {{ quizTitle }}</p>
            <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">
              Domande aggiunte: {{ questions.length }}
            </p>
          </div>
          
          <!-- QR Code Section -->
          <div *ngIf="qrCodeUrl" style="text-align: center;">
            <p style="color: #666; margin: 0 0 10px 0; font-size: 14px; font-weight: 600;">ğŸ“± Condividi per aggiungere domande:</p>
            <img [src]="qrCodeUrl" alt="QR Code" style="max-width: 150px; width: 100%; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
            <p style="color: #999; margin: 8px 0 0 0; font-size: 11px; word-break: break-all;">{{ addQuestionUrl }}</p>
          </div>
        </div>
      </div>

      <h2 style="color: #667eea; margin-bottom: 20px;">2. Aggiungi Domande</h2>

      <!-- Question Type Selection -->
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Tipo Domanda:</label>
        <div style="display: flex; gap: 10px;">
          <button 
            class="btn"
            [class.btn-primary]="currentQuestion.type === 'text'"
            [class.btn-secondary]="currentQuestion.type !== 'text'"
            (click)="currentQuestion.type = 'text'; removeImage()"
            style="flex: 1; padding: 12px;">
            ğŸ“ Solo Testo
          </button>
          <button 
            class="btn"
            [class.btn-primary]="currentQuestion.type === 'image'"
            [class.btn-secondary]="currentQuestion.type !== 'image'"
            (click)="currentQuestion.type = 'image'"
            style="flex: 1; padding: 12px;">
            ğŸ–¼ï¸ Testo + Foto
          </button>
        </div>
      </div>

      <!-- Image Upload (if image type) -->
      <div *ngIf="currentQuestion.type === 'image'" style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Immagine:</label>
        
        <div *ngIf="!currentQuestion.imagePreview" 
             class="image-upload-zone"
             (click)="fileInput.click()">
          <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“·</div>
          <p style="color: #666; margin: 0; font-weight: 500;">Clicca per caricare un'immagine</p>
          <small style="color: #999;">PNG, JPG, GIF (max 5MB)</small>
        </div>

        <div *ngIf="currentQuestion.imagePreview" style="position: relative;">
          <img [src]="currentQuestion.imagePreview" style="width: 100%; max-height: 400px; object-fit: contain; border-radius: 8px; border: 2px solid #e2e8f0;" />
          <button 
            (click)="removeImage()"
            class="remove-image-btn">
            Ã—
          </button>
        </div>

        <input 
          #fileInput
          type="file" 
          accept="image/*"
          (change)="onImageSelect($event)"
          style="display: none;"
        />
      </div>

      <!-- Question Text -->
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 600;">Testo Domanda:</label>
        <textarea 
          [(ngModel)]="currentQuestion.question" 
          placeholder="Scrivi qui la domanda..."
          rows="3"
          style="width: 100%; resize: vertical; font-size: 16px;"
        ></textarea>
      </div>

      <!-- Answers -->
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 12px; font-weight: 600;">Risposte:</label>
        <div *ngFor="let answer of currentQuestion.answers; let i = index" 
             class="answer-input"
             [class.answer-input-correct]="currentQuestion.correct_answer === i">
          <input 
            type="radio" 
            [name]="'correct'"
            [checked]="currentQuestion.correct_answer === i"
            (change)="currentQuestion.correct_answer = i"
            style="width: 24px; height: 24px; cursor: pointer; accent-color: #48bb78;"
          />
          <div class="answer-letter"
               [class.answer-letter-correct]="currentQuestion.correct_answer === i">
            {{ String.fromCharCode(65 + i) }}
          </div>
          <input 
            type="text" 
            [(ngModel)]="currentQuestion.answers[i]" 
            [placeholder]="'Risposta ' + (i + 1)"
            style="flex: 1; font-size: 15px;"
          />
          <span *ngIf="currentQuestion.correct_answer === i" class="check-mark">
            âœ“
          </span>
        </div>
        <small style="color: #666; display: block; margin-top: 8px;">ğŸ’¡ Seleziona il radio button per indicare la risposta corretta</small>
      </div>

      <!-- Add Question Button -->
      <button 
        class="btn btn-success" 
        (click)="addQuestion()" 
        [disabled]="loading"
        style="width: 100%; margin-bottom: 30px; font-size: 18px; padding: 16px; background: #48bb78; font-weight: 600;">
        {{ loading ? 'â³ Aggiunta...' : 'â• Aggiungi Domanda' }}
      </button>

      <!-- Questions List -->
      <div *ngIf="questions.length > 0" style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e2e8f0;">
        <h3 style="color: #667eea; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
          ğŸ“‹ Domande Aggiunte ({{ questions.length }})
        </h3>
        <div *ngFor="let q of questions; let i = index" 
             style="background: #f7faff; padding: 16px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid #667eea;">
          <div style="display: flex; justify-content: space-between; align-items: start; gap: 15px;">
            <div style="flex: 1;">
              <div style="margin-bottom: 8px;">
                <span style="background: #667eea; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; margin-right: 8px;">
                  {{ q.type === 'image' ? 'ğŸ–¼ï¸ Immagine' : 'ğŸ“ Testo' }}
                </span>
                <span style="color: #666; font-size: 14px;">Domanda {{ i + 1 }}</span>
              </div>
              <strong style="color: #2d3748; font-size: 16px;">{{ q.question }}</strong>
              <div style="margin-top: 8px; color: #666; font-size: 14px;">
                âœ… Risposta corretta: <strong>{{ String.fromCharCode(65 + q.correct_answer) }}. {{ q.answers[q.correct_answer] }}</strong>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Finish Button -->
      <div style="margin-top: 30px; display: flex; gap: 10px;">
        <button class="btn btn-secondary" (click)="goBack()" style="flex: 1;">
          â† Annulla
        </button>
        <button 
          class="btn btn-primary" 
          (click)="finishQuiz()" 
          [disabled]="questions.length === 0"
          style="flex: 2; font-size: 18px; padding: 16px;">
          âœ… Completa Quiz ({{ questions.length }} domande)
        </button>
      </div>
    </div>
  </div>
</div>