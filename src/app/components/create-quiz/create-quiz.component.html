<div class="container">
  <div class="card quiz-creation-card">
    <!-- Header -->
    <div class="header-section">
      <h1 class="main-title">
        <span class="icon">‚úèÔ∏è</span> Crea Nuovo Quiz
      </h1>
      <p class="subtitle" *ngIf="!quizCreated">Compila le informazioni per iniziare</p>
      <p class="subtitle" *ngIf="quizCreated">Aggiungi domande al tuo quiz</p>
    </div>

    <!-- Status Messages -->
    <div *ngIf="error" class="alert alert-error" role="alert">
      <span class="alert-icon">‚ö†Ô∏è</span>
      <span>{{ error }}</span>
    </div>

    <div *ngIf="success" class="alert alert-success" role="alert">
      <span class="alert-icon">‚úÖ</span>
      <span>{{ success }}</span>
    </div>

    <!-- Step 1: Create Quiz -->
    <div *ngIf="!quizCreated" class="step-section">
      <div class="step-header">
        <span class="step-number">1</span>
        <h2>Informazioni Quiz</h2>
      </div>
      
      <form class="form-section">
        <div class="form-group">
          <label for="quizName" class="form-label required">Nome Quiz (ID):</label>
          <input 
            id="quizName"
            type="text" 
            [(ngModel)]="quizName"
            name="quizName"
            placeholder="es: quiz-storia-2024"
            class="form-input"
            [class.input-error]="error && !quizName.trim()"
            maxlength="50"
          />
          <small class="form-hint">Identificatore univoco (solo lettere, numeri, trattini e underscore)</small>
        </div>

        <div class="form-group">
          <label for="quizTitle" class="form-label required">Titolo:</label>
          <input 
            id="quizTitle"
            type="text" 
            [(ngModel)]="quizTitle"
            name="quizTitle"
            placeholder="es: Quiz di Storia - Seconda Guerra Mondiale"
            class="form-input"
            [class.input-error]="error && !quizTitle.trim()"
            maxlength="100"
          />
          <small class="form-hint">Nome descrittivo che verr√† mostrato agli utenti</small>
        </div>

        <div class="form-group">
          <label for="quizDescription" class="form-label">Descrizione (opzionale):</label>
          <textarea 
            id="quizDescription"
            [(ngModel)]="quizDescription"
            name="quizDescription"
            placeholder="Breve descrizione del contenuto del quiz..."
            rows="3"
            class="form-input"
            maxlength="500"
          ></textarea>
          <small class="form-hint">Aiuta gli utenti a capire il contenuto del quiz</small>
        </div>
      </form>

      <div class="action-buttons">
        <button type="button" class="btn btn-secondary" (click)="goBack()">
          <span>‚Üê Annulla</span>
        </button>
        <button 
          type="button"
          class="btn btn-primary" 
          (click)="createQuiz()" 
          [disabled]="loading || !quizName.trim() || !quizTitle.trim()">
          <span>{{ loading ? '‚è≥ Creazione...' : 'Continua ‚Üí' }}</span>
        </button>
      </div>
    </div>

    <!-- Step 2: Add Questions -->
    <div *ngIf="quizCreated" class="step-section">
      <!-- Quiz Info Banner -->
      <div class="info-banner">
        <div class="info-content">
          <div class="info-text">
            <h3 class="info-title">üéÆ {{ quizTitle }}</h3>
            <p class="info-subtitle">
              <span class="badge">{{ questions.length }} domande</span>
              <span *ngIf="quizDescription" class="info-description">{{ quizDescription }}</span>
            </p>
          </div>
          
          <!-- QR Code Section -->
          <div *ngIf="qrCodeUrl" class="qr-section">
            <p class="qr-label">üì± Condividi</p>
            <img [src]="qrCodeUrl" alt="QR Code" class="qr-code" />
            <small class="qr-url">{{ addQuestionUrl }}</small>
          </div>
        </div>
      </div>

      <!-- Step Header -->
      <div class="step-header">
        <span class="step-number">2</span>
        <h2>Aggiungi Domande</h2>
      </div>

      <!-- Question Type Selection -->
      <div class="form-group">
        <label class="form-label">Tipo Domanda:</label>
        <div class="button-group">
          <button 
            type="button"
            class="btn-toggle"
            [class.active]="currentQuestion.type === 'text'"
            (click)="currentQuestion.type = 'text'; removeImage()"
            aria-label="Solo testo">
            <span class="toggle-icon">üìù</span>
            <span>Solo Testo</span>
          </button>
          <button 
            type="button"
            class="btn-toggle"
            [class.active]="currentQuestion.type === 'image'"
            (click)="currentQuestion.type = 'image'"
            aria-label="Testo con immagine">
            <span class="toggle-icon">üñºÔ∏è</span>
            <span>Testo + Foto</span>
          </button>
        </div>
      </div>

      <!-- Image Upload -->
      <div *ngIf="currentQuestion.type === 'image'" class="form-group">
        <label class="form-label required">Immagine:</label>
        
        <div *ngIf="!currentQuestion.imagePreview" class="image-upload-zone" (click)="fileInput.click()">
          <div class="upload-icon">üì∑</div>
          <p class="upload-text">Clicca per caricare un'immagine</p>
          <small class="upload-hint">PNG, JPG, GIF (max 5MB)</small>
        </div>

        <div *ngIf="currentQuestion.imagePreview" class="image-preview-container">
          <img [src]="currentQuestion.imagePreview" alt="Anteprima immagine" class="image-preview" />
          <button 
            type="button"
            (click)="removeImage()"
            class="remove-image-btn"
            aria-label="Rimuovi immagine">
            √ó
          </button>
        </div>

        <input 
          #fileInput
          type="file" 
          accept="image/*"
          (change)="onImageSelect($event)"
          style="display: none;"
          aria-label="Seleziona file immagine"
        />
      </div>

      <!-- Question Text -->
      <div class="form-group">
        <label for="questionText" class="form-label required">Testo Domanda:</label>
        <textarea 
          id="questionText"
          [(ngModel)]="currentQuestion.question"
          name="questionText"
          placeholder="Scrivi qui la tua domanda..."
          rows="3"
          class="form-input"
          maxlength="500"
        ></textarea>
        <small class="form-hint">Scrivi una domanda chiara e concisa</small>
      </div>

      <!-- Answers -->
      <div class="form-group">
        <label class="form-label required">Risposte:</label>
        <p class="form-hint" style="margin-bottom: 16px;">üí° Seleziona il cerchio per indicare la risposta corretta</p>
        
        <div *ngFor="let answer of currentQuestion.answers; let i = index; trackBy: trackByIndex" 
             class="answer-input"
             [class.answer-input-correct]="currentQuestion.correct_answer === i">
          <input 
            type="radio" 
            [id]="'correct-' + i"
            [name]="'correct'"
            [checked]="currentQuestion.correct_answer === i"
            (change)="currentQuestion.correct_answer = i"
            class="answer-radio"
            [attr.aria-label]="'Seleziona risposta ' + String.fromCharCode(65 + i) + ' come corretta'"
          />
          <label [for]="'correct-' + i" class="answer-letter" [class.answer-letter-correct]="currentQuestion.correct_answer === i">
            {{ String.fromCharCode(65 + i) }}
          </label>
          <input 
            type="text"
            [id]="'answer-' + i"
            [(ngModel)]="currentQuestion.answers[i]"
            [name]="'answer-' + i"
            [placeholder]="'Risposta ' + (i + 1)"
            class="answer-text-input"
            maxlength="200"
            [attr.aria-label]="'Testo risposta ' + String.fromCharCode(65 + i)"
          />
          <span *ngIf="currentQuestion.correct_answer === i" class="check-mark" aria-hidden="true">
            ‚úì
          </span>
        </div>
      </div>

      <!-- Add Question Button -->
      <button 
        type="button"
        class="btn btn-success btn-large" 
        (click)="addQuestion()" 
        [disabled]="loading">
        <span>{{ loading ? '‚è≥ Aggiunta in corso...' : '‚ûï Aggiungi Domanda' }}</span>
      </button>

      <!-- Questions List -->
      <div *ngIf="questions.length > 0" class="questions-list">
        <h3 class="section-title">
          <span>üìã Domande Aggiunte</span>
          <span class="badge badge-primary">{{ questions.length }}</span>
        </h3>
        
        <div *ngFor="let q of questions; let i = index; trackBy: trackByIndex" class="question-card">
          <div class="question-card-header">
            <span class="question-type-badge" [class.image-badge]="q.type === 'image'">
              {{ q.type === 'image' ? 'üñºÔ∏è Immagine' : 'üìù Testo' }}
            </span>
            <span class="question-number">Domanda {{ i + 1 }}</span>
          </div>
          <p class="question-text">{{ q.question }}</p>
          <div class="question-correct-answer">
            <strong>‚úÖ Risposta corretta:</strong> 
            <span class="correct-label">{{ String.fromCharCode(65 + q.correct_answer) }}</span>
            {{ q.answers[q.correct_answer] }}
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button type="button" class="btn btn-secondary" (click)="goBack()">
          <span>‚Üê Esci</span>
        </button>
        <button 
          type="button"
          class="btn btn-primary btn-large" 
          (click)="finishQuiz()" 
          [disabled]="questions.length === 0">
          <span>‚úÖ Completa Quiz ({{ questions.length }} domande)</span>
        </button>
      </div>
    </div>
  </div>
</div>