<div class="container">
  <!-- Waiting State -->
  <div *ngIf="gameState === 'waiting'" class="card" style="margin-top: 50px;">
    <h1 style="text-align: center; color: #667eea; margin-bottom: 30px;">
      ğŸ¯ Sessione Creata!
    </h1>

    <div style="background: #f7faff; padding: 20px; border-radius: 12px; margin-bottom: 30px; text-align: center; border: 2px solid #667eea;">
      <h2 style="color: #667eea; margin: 0 0 10px 0; font-size: 48px; font-weight: 800;">
        {{ sessionId }}
      </h2>
      <p style="color: #666; margin: 0;">Condividi questo codice con i giocatori</p>
    </div>

    <!-- QR Code -->
    <div *ngIf="qrCodeUrl" style="text-align: center; margin-bottom: 30px;">
      <p style="color: #666; margin-bottom: 15px; font-weight: 600;">Oppure scannerizza il QR Code:</p>
      <img [src]="qrCodeUrl" alt="QR Code" style="max-width: 300px; width: 100%; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" />
      <p style="color: #999; margin-top: 10px; font-size: 14px;">{{ joinUrl }}</p>
    </div>

    <!-- Players List -->
    <div style="margin-bottom: 30px;">
      <h3 style="color: #667eea; margin-bottom: 15px;">
        ğŸ‘¥ Giocatori Connessi ({{ players.length }})
      </h3>
      <div *ngIf="players.length === 0" style="text-align: center; padding: 30px; color: #999;">
        <div style="font-size: 48px; margin-bottom: 10px;">â³</div>
        <p>In attesa di giocatori...</p>
      </div>
      <div *ngFor="let player of players" class="player-item">
        ğŸ® {{ player.name }}
      </div>
    </div>

    <!-- Start Button -->
    <div style="display: flex; gap: 10px;">
      <button class="btn btn-secondary" (click)="goHome()" style="flex: 1;">
        â† Annulla
      </button>
      <button 
        class="btn btn-primary" 
        (click)="startGame()" 
        [disabled]="players.length === 0"
        style="flex: 2; font-size: 18px; padding: 16px;">
        ğŸš€ Avvia Quiz
      </button>
    </div>
  </div>

  <!-- Playing State -->
  <div *ngIf="gameState === 'playing' && currentQuestion" class="card" style="margin-top: 50px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <span style="color: #667eea; font-weight: 600;">
        Domanda {{ currentQuestion.question_number }} / {{ currentQuestion.total_questions }}
      </span>
      <div class="timer" [class.timer-warning]="timeRemaining <= 3">
        â±ï¸ {{ timeRemaining }}s
      </div>
    </div>

    <!-- Image if present -->
    <div *ngIf="currentQuestion.type === 'image' && currentQuestion.image_url" 
         style="text-align: center; margin-bottom: 30px;">
      <img 
        [src]="currentQuestion.image_url" 
        alt="Question image"
        style="max-width: 100%; max-height: 400px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);" />
    </div>

    <h2 style="color: #2d3748; margin-bottom: 30px; text-align: center;">
      {{ currentQuestion.question }}
    </h2>

    <div class="answers-grid">
      <div 
        *ngFor="let answer of currentQuestion.answers; let i = index" 
        class="answer-box"
        [class.correct]="correctAnswer === i">
        <div class="answer-letter">{{ String.fromCharCode(65 + i) }}</div>
        <div class="answer-text">{{ answer }}</div>
      </div>
    </div>

    <!-- Leaderboard during game -->
    <div *ngIf="leaderboard.length > 0" style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e2e8f0;">
      <h3 style="color: #667eea; margin-bottom: 15px; text-align: center;">
        ğŸ† Classifica Parziale
      </h3>
      <div *ngFor="let entry of leaderboard.slice(0, 5); let i = index" class="leaderboard-item">
        <span class="position">{{ i + 1 }}</span>
        <span class="name">{{ entry.name }}</span>
        <span class="score">{{ entry.score | number:'1.0-0' }} pt</span>
      </div>
    </div>
  </div>

  <!-- Finished State -->
  <div *ngIf="gameState === 'finished'" class="card" style="margin-top: 50px;">
    <h1 style="text-align: center; color: #667eea; margin-bottom: 30px;">
      ğŸ† Quiz Terminato!
    </h1>

    <div style="text-align: center; margin-bottom: 40px;">
      <div style="font-size: 80px; margin-bottom: 20px;">ğŸ‰</div>
    </div>

    <h2 style="color: #667eea; margin-bottom: 20px; text-align: center;">
      Classifica Finale
    </h2>

    <div *ngFor="let entry of leaderboard; let i = index" 
         class="leaderboard-item"
         [class.winner]="i === 0">
      <span class="position" [class.gold]="i === 0" [class.silver]="i === 1" [class.bronze]="i === 2">
        {{ i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : (i + 1) }}
      </span>
      <div style="flex: 1;">
        <div class="name" [style.font-size]="i === 0 ? '24px' : '18px'">{{ entry.name }}</div>
        <div style="color: #666; font-size: 14px;">{{ entry.correct_answers }} risposte corrette</div>
      </div>
      <span class="score" [style.font-size]="i === 0 ? '28px' : '20px'">
        {{ entry.score | number:'1.0-0' }} pt
      </span>
    </div>

    <button class="btn btn-primary" (click)="goHome()" style="width: 100%; margin-top: 30px; font-size: 18px; padding: 16px;">
      ğŸ  Torna alla Home
    </button>
  </div>
</div>