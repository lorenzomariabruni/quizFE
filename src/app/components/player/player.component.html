<div class="player-container">
  <!-- Connection Banner -->
  <div *ngIf="showConnectionBanner" class="connection-banner">
    <p>âš ï¸ Connessione persa. Tentativo di riconnessione...</p>
  </div>

  <!-- Join Screen -->
  <div *ngIf="!joined" class="join-screen">
    <div class="join-card">
      <h1>ğŸ® Unisciti al Quiz</h1>
      <p class="session-id">Sessione: <strong>{{ sessionId }}</strong></p>

      <div *ngIf="error" class="error-message">
        âŒ {{ error }}
      </div>

      <input
        type="text"
        [(ngModel)]="playerName"
        placeholder="Inserisci il tuo nome"
        (keyup.enter)="joinSession()"
        [disabled]="joining"
        class="name-input"
      />

      <button
        (click)="joinSession()"
        [disabled]="!playerName.trim() || joining"
        class="join-button">
        {{ joining ? 'â³ Connessione...' : 'ğŸš€ Inizia!' }}
      </button>
    </div>
  </div>

  <!-- Waiting Screen -->
  <div *ngIf="joined && gameState === 'waiting'" class="waiting-screen">
    <div class="waiting-card">
      <h1>â³ In Attesa...</h1>
      <p class="player-name">Ciao, <strong>{{ playerName }}</strong>!</p>
      <p class="waiting-message">Aspettando che l'host inizi il gioco...</p>
      <div class="spinner"></div>
    </div>
  </div>

  <!-- Playing Screen -->
  <div *ngIf="joined && gameState === 'playing' && currentQuestion" class="playing-screen">
    <!-- Header -->
    <div class="game-header">
      <div class="score-display">
        <span class="score-label">Punteggio</span>
        <span class="score-value">{{ totalScore }}</span>
      </div>
      <div class="question-counter">
        Domanda {{ currentQuestion.question_number }} / {{ currentQuestion.total_questions }}
      </div>
      <div class="timer" [class.timer-warning]="timeRemaining <= 3">
        â±ï¸ {{ timeRemaining }}s
      </div>
    </div>

    <!-- Question Image (if exists) -->
    <div *ngIf="currentQuestion.type === 'image' && currentQuestion.image_url" class="question-image-container">
      <img [src]="currentQuestion.image_url" alt="Question image" class="question-image" />
    </div>

    <!-- Question Text -->
    <div class="question-card">
      <h2 class="question-text">{{ currentQuestion.question }}</h2>
    </div>

    <!-- Answer Status (after submission, before results) -->
    <div *ngIf="answered && !showingResults" class="answer-status">
      <div class="status-card waiting-results">
        <div class="status-icon">â³</div>
        <p class="status-message">Risposta inviata!</p>
        <p class="status-detail">Attendere i risultati...</p>
      </div>
    </div>

    <!-- Answers Grid -->
    <div class="answers-grid" [class.disabled]="answered">
      <button
        *ngFor="let answer of currentQuestion.answers; let i = index"
        class="answer-button"
        [class.selected]="selectedAnswer === i && !showingResults"
        [class.correct]="isCorrectAnswer(i)"
        [class.wrong]="isWrongAnswer(i)"
        [disabled]="answered"
        (click)="selectAnswer(i)">
        <span class="answer-letter">{{ String.fromCharCode(65 + i) }}</span>
        <span class="answer-text">{{ answer }}</span>
        <span *ngIf="isCorrectAnswer(i)" class="result-icon">âœ…</span>
        <span *ngIf="isWrongAnswer(i)" class="result-icon">âŒ</span>
      </button>
    </div>

    <!-- Submit Button -->
    <button
      *ngIf="!answered"
      class="submit-button"
      [disabled]="selectedAnswer === null"
      (click)="submitAnswer()">
      âœ… Invia Risposta
    </button>

    <!-- Results Display -->
    <div *ngIf="showingResults" class="results-display">
      <div class="points-earned" [class.no-points]="pointsEarned === 0">
        <span class="points-value">{{ pointsEarned > 0 ? '+' + pointsEarned : pointsEarned }}</span>
        <span class="points-label">punti</span>
      </div>
    </div>
  </div>

  <!-- Finished Screen -->
  <div *ngIf="joined && gameState === 'finished'" class="finished-screen">
    <div class="finished-card">
      <h1>ğŸ† Quiz Completato!</h1>

      <div class="final-score">
        <p class="score-label">Punteggio Finale</p>
        <p class="score-value">{{ totalScore }}</p>
      </div>

      <h2 class="leaderboard-title">ğŸ… Classifica</h2>
      <div class="leaderboard">
        <div
          *ngFor="let player of leaderboard; let i = index"
          class="leaderboard-item"
          [class.highlight]="player.name === playerName">
          <span class="position" [ngClass]="{
            'gold': i === 0,
            'silver': i === 1,
            'bronze': i === 2
          }">
            {{ i + 1 }}
          </span>
          <span class="name">{{ player.name }}</span>
          <span class="stats">
            <span class="correct">âœ… {{ player.correct_answers }}</span>
            <span class="score">{{ player.score }} pt</span>
          </span>
        </div>
      </div>

      <button class="home-button" (click)="goHome()">
        ğŸ  Torna alla Home
      </button>
    </div>
  </div>
</div>