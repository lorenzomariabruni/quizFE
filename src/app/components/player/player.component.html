<div class="player-container">
  <!-- Connection Banner -->
  <div class="connection-banner" *ngIf="showConnectionBanner">
    âš ï¸ Connessione persa... Riconnessione in corso...
  </div>

  <!-- Join Screen -->
  <div class="join-screen" *ngIf="!joined">
    <div class="join-card">
      <h1>ğŸ® Unisciti al Quiz</h1>
      <p class="session-id">Sessione: <strong>{{ sessionId }}</strong></p>

      <div class="error-message" *ngIf="error">
        {{ error }}
      </div>

      <input
        type="text"
        [(ngModel)]="playerName"
        placeholder="Inserisci il tuo nome"
        class="name-input"
        maxlength="20"
        (keyup.enter)="joinSession()"
        [disabled]="joining"
      />

      <button
        class="join-button"
        (click)="joinSession()"
        [disabled]="!playerName.trim() || joining"
      >
        {{ joining ? 'â³ Connessione...' : 'ğŸš€ Inizia!' }}
      </button>
    </div>
  </div>

  <!-- Waiting Screen -->
  <div class="waiting-screen" *ngIf="joined && gameState === 'waiting'">
    <div class="waiting-card">
      <h1>â³ In Attesa...</h1>
      <p class="player-name">Ciao, <strong>{{ playerName }}</strong>!</p>
      <p class="waiting-message">Aspettando che l'host avvii il gioco...</p>
      <div class="spinner"></div>
    </div>
  </div>

  <!-- Playing Screen -->
  <div class="playing-screen" *ngIf="joined && gameState === 'playing' && currentQuestion">
    <!-- Header with Score and Timer -->
    <div class="game-header">
      <div class="score-display">
        <span class="score-label">Punteggio</span>
        <span class="score-value">{{ totalScore | number:'1.0-0' }}</span>
      </div>
      <span class="question-counter">
        Domanda {{ currentQuestion.question_number }}/{{ currentQuestion.total_questions }}
      </span>
      <div class="timer" [class.timer-warning]="timeRemaining <= 3">
        â±ï¸ {{ timeRemaining }}s
      </div>
    </div>

    <!-- Question Image (if available) -->
    <div class="question-image-container" *ngIf="currentQuestion.type === 'image' && currentQuestion.image_url">
      <img [src]="currentQuestion.image_url" alt="Question image" class="question-image" />
    </div>

    <!-- Question Text -->
    <div class="question-card">
      <h2 class="question-text">{{ currentQuestion.question }}</h2>
    </div>

    <!-- Answer Status / Results -->
    <div class="answer-status" *ngIf="answered">
      <div class="status-card" [class.waiting-results]="!showingResults">
        <div *ngIf="!showingResults">
          <div class="status-icon">â³</div>
          <p class="status-message">Risposta Inviata!</p>
          <p class="status-detail">Aspettando gli altri giocatori...</p>
        </div>
        <div *ngIf="showingResults" class="results-display">
          <div class="points-earned" [class.no-points]="pointsEarned === 0">
            <span class="points-value">{{ pointsEarned | number:'1.0-0' }}</span>
            <span class="points-label">punti</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Answers Grid -->
    <div class="answers-grid" [class.disabled]="answered">
      <button
        *ngFor="let answer of currentQuestion.answers; let i = index"
        class="answer-button"
        [class.selected]="selectedAnswer === i && !showingResults"
        [class.correct]="showingResults && isCorrectAnswer(i)"
        [class.wrong]="showingResults && isWrongAnswer(i)"
        (click)="selectAnswer(i)"
        [disabled]="answered || showingResults"
      >
        <span class="answer-letter">{{ String.fromCharCode(65 + i) }}</span>
        <span class="answer-text">{{ answer }}</span>
        <span class="result-icon" *ngIf="showingResults && isCorrectAnswer(i)">âœ…</span>
        <span class="result-icon" *ngIf="showingResults && isWrongAnswer(i)">âŒ</span>
      </button>
    </div>

    <!-- Submit Button -->
    <button
      *ngIf="!answered && !showingResults"
      class="submit-button"
      (click)="submitAnswer()"
      [disabled]="selectedAnswer === null"
    >
      ğŸ“¤ Invia Risposta
    </button>
  </div>

  <!-- Finished Screen -->
  <div class="finished-screen" *ngIf="joined && gameState === 'finished'">
    <div class="finished-card">
      <h1>ğŸ† Game Over!</h1>

      <!-- Final Score -->
      <div class="final-score">
        <p class="score-label">Il Tuo Punteggio Finale</p>
        <h2 class="score-value">{{ totalScore | number:'1.0-0' }}</h2>
      </div>

      <!-- Leaderboard -->
      <h3 class="leaderboard-title">ğŸ… Classifica Finale</h3>
      <div class="leaderboard">
        <div
          *ngFor="let player of leaderboard; let i = index"
          class="leaderboard-item"
          [class.highlight]="player.name === playerName"
        >
          <span
            class="position"
            [class.gold]="i === 0"
            [class.silver]="i === 1"
            [class.bronze]="i === 2"
          >
            <span *ngIf="i === 0">ğŸ¥‡</span>
            <span *ngIf="i === 1">ğŸ¥ˆ</span>
            <span *ngIf="i === 2">ğŸ¥‰</span>
            <span *ngIf="i > 2">{{ i + 1 }}</span>
          </span>
          <span class="name">{{ player.name }}</span>
          <div class="stats">
            <span class="correct">âœ… {{ player.correct_answers }}</span>
            <span class="score">{{ player.score | number:'1.0-0' }}</span>
          </div>
        </div>
      </div>

      <!-- Home Button -->
      <button class="home-button" (click)="goHome()">
        ğŸ  Torna alla Home
      </button>
    </div>
  </div>
</div>